I have added a new button named **"Apply From Name"** for the Custom From Name field. This button now independently applies the new name to the header without needing to press the main "Apply" button. I have also added a status indicator to show when the name has been successfully applied.

Here is the updated code:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NEWSLITTER Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Combined CSS from both files, with minor tweaks for compatibility */
    :root{
      --brand:#6f42c1; --ok:#28a745; --warn:#fd7e14; --info:#17a2b8; --danger:#dc3545; --primary:#007bff;
      --bg1:#f8f9fa; --bg2:#e9ecef; --text:#333; --muted:#666; --border:#dee2e6; --panel:#fff;
      --dark-bg1:#1a1a2e; --dark-bg2:#16213e; --dark-text:#e6e6e6; --dark-muted:#a0a0a0; --dark-border:#2d4059; --dark-panel:#0f3460;
    }
    *{box-sizing:border-box; margin:0; padding:0;}
    body{
      font-family:"Segoe UI", Tahoma, sans-serif; 
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color:var(--text); 
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      padding: 0;
    }
    .main-container{
      max-width: 1600px;
      margin: 0 auto;
      background:var(--panel); 
      border-radius: 0;
      padding: 25px;
      transition: background 0.3s;
    }
    .content-wrapper {
      max-width: 1600px;
      margin: 0 auto;
    }
    h2{ text-align:center; color:var(--brand); margin:0 0 18px }
    h3{ color:#495057; margin:24px 0 10px; transition: color 0.3s; }
    label{ font-weight:600; color:#495057; transition: color 0.3s; }
    textarea{
      width:100%; min-height:200px; margin-top:8px; padding:12px; border:2px solid var(--brand); border-radius:10px;
      font-size:13px; background:#fdfdfd; resize:vertical; white-space:pre-wrap; box-shadow: inset 0 2px 4px rgba(0,0,0,.1);
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      transition: background 0.3s, border-color 0.3s;
    }
    input[type=text]{
      padding:10px 12px; border:2px solid var(--brand); border-radius:10px; width:100%; max-width:420px;
      font-size:14px; margin:6px 0 10px; transition: background 0.3s, border-color 0.3s, color 0.3s;
    }
    .buttons{ margin-top:18px; display:flex; flex-wrap:wrap; gap:10px }
    .btn{ padding:12px 18px; border:none; border-radius:25px; font-size:14px; cursor:pointer; color:#fff;
      transition:transform .2s, box-shadow .2s, background 0.3s; }
    .btn:hover{ transform:translateY(-2px); box-shadow:0 4px 10px rgba(0,0,0,.2) }
    .import-btn{ background:var(--brand) } .clean-btn{ background:var(--ok) } .export-btn{ background:var(--warn) }
    .clear-btn{ background:var(--info) } .deselect-btn{ background:var(--danger) } .apply-btn{ background:var(--primary) }
    .insert-btn{ background:#ff5722 } .subject-btn{ background:#9c27b0 } .custom-name-btn{ background: #ff9800 }
    .encode-btn{ background:#2196f3 } .decode-btn{ background:#4caf50 }
    .copy-btn { background: #2ecc71; color: white; }
    .copy-btn:hover { background: #27ae60; transform: translateY(-2px); }
    .clear-btn.extraction-clear { background: #e74c3c; color: white; }
    .clear-btn.extraction-clear:hover { background: #c0392b; transform: translateY(-2px); }

    .flex-2col{ display:flex; gap:18px; align-items:flex-start }
    .col{ flex:1; min-width:0 }

    .headers-box{
      margin: 10px 0 0; padding: 12px; border-radius:10px; background:#f8f9fa; border:1px solid var(--border);
      max-height:200px; overflow:auto; transition: background 0.3s, border-color 0.3s;
    }
    .headers-box label{ display:inline-block; margin:0 12px 8px 0 }

    .options{ margin: 16px 0 }
    .options textarea{ width:90%; height:120px }

    /* Always select */
    .always-box{ margin:10px 0; padding:8px; background:#f1f3f5; border-radius:8px; transition: background 0.3s; }
    .always-inner{ display:flex; gap:8px; align-items:center; margin-top:5px }
    #alwaysSelect{ flex:1; padding:8px; border:2px solid var(--brand); border-radius:8px; transition: background 0.3s, border-color 0.3s, color 0.3s; }
    #applySelectBtn,#resetDefaultBtn{ padding:8px 12px; background:#6c757d; color:#fff; border:none; border-radius:88px; cursor:pointer; transition: background 0.3s; }
    #applySelectBtn:hover,#resetDefaultBtn:hover{ background:#5a6268 }

    /* Filename input for export */
    .filename-input {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .filename-input input {
      flex: 1;
      max-width: 300px;
      margin: 0;
    }

    /* LIVE PREVIEW AREA */
    .viewer-bar{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin:16px 0 }
    .viewer-toggles{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .toggle{ position:relative; display:inline-flex; border:1px solid var(--border); border-radius:999px; overflow:hidden; transition: border-color 0.3s; }
    .toggle button{ background:#fff; color:#495057; border:none; padding:8px 14px; cursor:pointer; transition: background 0.3s, color 0.3s; }
    .toggle button.active{ background:var(--brand); color:#fff }
    .live-check{ user-select:none; font-size:13px; color:#495057; transition: color 0.3s; }

    .preview-wrap{ border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#fff; box-shadow: inset 0 1px 0 rgba(0,0,0,.03); transition: border-color 0.3s, background 0.3s; }
    .split{ display:flex; gap:16px }
    .split .pane{ flex:1; min-width:0 }

    /* Gmail-ish chrome */
    .gmail-chrome{ background:#f6f8fc; border-bottom:1px solid #e5e7eb; padding:10px 14px; display:flex; gap:10px; align-items:center; transition: background 0.3s, border-color 0.3s; }
    .chip{ font-size:12px; background:#e9eefc; color:#3f51b5; padding:4px 8px; border-radius:999px; transition: background 0.3s, color 0.3s; }
    .gmail-body{ padding:24px; background:#fff; min-height:420px; transition: background 0.3s; }
    iframe#gmailFrame{ width:100%; height:480px; border:0; background:#fff; transition: background 0.3s; }

    /* Source code look */
    .code-view{ margin:0; padding:14px; height:480px; overflow:auto; background:#0b1020; color:#e6edf3; font-size:12px; line-height:1.4 }
    .code-view code{ counter-reset: ln }
    .code-view code span{ display:block; white-space:pre; font-family:inherit }
    .code-view code span:before{ counter-increment: ln; content: counter(ln); display:inline-block; width:2.5em; margin-right:.75em; color:#6e7681 }

    /* Dark mode toggle */
    .dark-mode-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 60px;
      height: 30px;
      border-radius: 15px;
      background: #ccc;
      cursor: pointer;
      transition: background 0.3s;
      z-index: 100;
    }
    .dark-mode-toggle:before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 26px;
      height: 26px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .dark-mode-toggle.active {
      background: var(--brand);
    }
    .dark-mode-toggle.active:before {
      transform: translateX(30px);
    }
    .dark-mode-toggle .tooltip {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .dark-mode-toggle:hover .tooltip {
      opacity: 1;
    }

    /* Tab navigation */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }
    .tab {
      padding: 12px 24px;
      cursor: pointer;
      background: #f1f3f5;
      border-radius: 8px 8px 0 0;
      margin-right: 4px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .tab.active {
      background: var(--brand);
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    /* Encoding options */
    .encoding-options {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .encoding-options label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: normal;
    }

    /* Action status indicators */
    .action-status {
      font-size: 12px;
      color: #28a745;
      margin-top: 5px;
      display: none;
    }
    .action-status.error {
      color: #dc3545;
    }

    /* History panel - UPDATED TO TAKE FULL BACKGROUND */
    .history-toggle {
      position: absolute;
      top: 20px;
      right: 90px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 8px 16px;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .history-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--panel);
      z-index: 9999;
      padding: 20px;
      overflow-y: auto;
      display: none;
      transition: all 0.3s;
    }
    .history-panel.active {
      display: block;
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
    }
    .history-categories {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .history-category {
      padding: 8px 16px;
      background: #f1f3f5;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .history-category.active {
      background: var(--brand);
      color: white;
    }
    .history-items-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
    }
    .history-item {
      padding: 15px;
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      background: #f8f9fa;
    }
    .history-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .history-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--brand);
      font-size: 14px;
    }
    .history-content {
      font-size: 12px;
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      margin-bottom: 8px;
    }
    .history-timestamp {
      font-size: 11px;
      color: #999;
      text-align: right;
    }
    .close-history {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      cursor: pointer;
    }
    .clear-history {
      display: block;
      text-align: center;
      margin-top: 20px;
      color: var(--danger);
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    .no-history {
      text-align: center;
      padding: 40px;
      color: var(--muted);
      font-style: italic;
    }

    /* Dark mode styles */
    body.dark-mode {
      background: linear-gradient(135deg, var(--dark-bg1), var(--dark-bg2));
      color: var(--dark-text);
    }
    body.dark-mode .main-container {
      background: var(--dark-panel);
      box-shadow: 0 8px 18px rgba(0,0,0,0.4);
    }
    body.dark-mode h3,
    body.dark-mode label {
      color: var(--dark-text);
    }
    body.dark-mode textarea,
    body.dark-mode input[type=text] {
      background: #2d3748;
      color: var(--dark-text);
      border-color: #6f42c1;
    }
    body.dark-mode .headers-box {
      background: #2d3748;
      border-color: var(--dark-border);
    }
    body.dark-mode .always-box {
      background: #2d3748;
    }
    body.dark-mode #alwaysSelect {
      background: #4a5568;
      color: var(--dark-text);
      border-color: #6f42c1;
    }
    body.dark-mode .toggle {
      border-color: var(--dark-border);
    }
    body.dark-mode .toggle button {
      background: #4a5568;
      color: var(--dark-text);
    }
    body.dark-mode .live-check {
      color: var(--dark-text);
    }
    body.dark-mode .preview-wrap {
      border-color: var(--dark-border);
      background: #2d3748;
    }
    body.dark-mode .gmail-chrome {
      background: #2d3748;
      border-color: var(--dark-border);
    }
    body.dark-mode .chip {
      background: #4a5568;
      color: #a3bffa;
    }
    body.dark-mode .gmail-body {
      background: #4a5568;
    }
    body.dark-mode iframe#gmailFrame {
      background: #4a5568;
    }
    body.dark-mode .tabs {
      border-color: var(--dark-border);
    }
    body.dark-mode .tab {
      background: #2d3748;
      color: var(--dark-text);
    }
    body.dark-mode .tab.active {
      background: var(--brand);
      color: white;
    }
    body.dark-mode .filename-input input {
      background: #4a5568;
      color: var(--dark-text);
      border-color: #6f42c1;
    }
    body.dark-mode .history-panel {
      background: var(--dark-panel);
      color: var(--dark-text);
    }
    body.dark-mode .history-item {
      background: #2d3748;
      border-color: var(--dark-border);
    }
    body.dark-mode .history-item:hover {
      background: #374151;
    }
    body.dark-mode .history-title {
      color: #a3bffa;
    }
    body.dark-mode .history-category {
      background: #2d3748;
      color: var(--dark-text);
    }
    body.dark-mode .history-category.active {
      background: var(--brand);
      color: white;
    }

    /* NEW: Layout adjustments for right-side placement */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .left-panel {
      grid-column: 1;
    }
    .right-panel {
      grid-column: 2;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .preview-section {
      grid-column: 2;
      grid-row: 1;
    }
    .output-section {
      grid-column: 2;
      grid-row: 2;
    }
    .insert-section {
      grid-column: 2;
      grid-row: 3;
    }

    @media (max-width: 1200px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      .preview-section,
      .output-section,
      .insert-section {
        grid-column: 1;
      }
      .preview-section {
        grid-row: 2;
      }
      .output-section {
        grid-row: 3;
      }
      .insert-section {
        grid-row: 4;
      }
    }
    @media (max-width: 1024px){ 
      .flex-2col{ flex-direction:column } 
      .history-items-container {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
    }
    @media (max-width: 768px) {
      .history-items-container {
        grid-template-columns: 1fr;
      }
      .history-categories {
        flex-direction: column;
      }
    }
    
    /* Styles for the new Extraction Tool tab */
    .extraction-options {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin: 20px 0;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
    }
    
    .option {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .option input {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }
    
    .option label {
        cursor: pointer;
        font-weight: 500;
    }
    
    .output-box {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        min-height: 150px;
        white-space: pre-wrap;
        font-family: monospace;
        overflow-y: auto;
        max-height: 300px;
    }
    
    .results-info {
        margin-top: 10px;
        font-style: italic;
        color: #7f8c8d;
    }
    
    .auto-extract-info {
        background: #e8f4fc;
        padding: 10px 15px;
        border-radius: 5px;
        margin-top: 10px;
        font-size: 0.9rem;
        color: #2c3e50;
        border-left: 4px solid #3498db;
    }
    
    .server-pattern-info {
        background: #fff3cd;
        padding: 10px 15px;
        border-radius: 5px;
        margin-top: 10px;
        font-size: 0.9rem;
        color: #856404;
        border-left: 4px solid #ffc107;
    }
    
    @media (max-width: 768px) {
        .extraction-options {
            flex-direction: column;
        }
    }
  </style>
</head>
<body>
  <div class="dark-mode-toggle" id="darkModeToggle" title="Toggle Dark Mode">
    <div class="tooltip">Toggle Dark Mode</div>
  </div>

  <button class="history-toggle" id="historyToggle">
    <span>搭 History</span>
  </button>

  <div class="history-panel" id="historyPanel">
    <div class="history-header">
      <h2>Activity History</h2>
      <button class="close-history" id="closeHistory">Close</button>
    </div>
    
    <div class="history-categories" id="historyCategories">
      <div class="history-category active" data-category="all">All Activities</div>
      <div class="history-category" data-category="cleaned">Cleaned Content</div>
      <div class="history-category" data-category="htmlInsert">HTML Inserted</div>
      <div class="history-category" data-category="export">Exported Files</div>
      <div class="history-category" data-category="subject">Subject Changes</div>
    </div>
    
    <div class="history-items-container" id="historyItems">
      </div>
    
    <div class="clear-history" id="clearHistory">Clear All History</div>
  </div>

  <div class="main-container">
    <div class="content-wrapper">
      <div style="font-size:13px;color:black;margin-bottom:8px">YOUSSEF DERRAZ CMH8</div>
      <h2>NEWSLITTER Cleaner & Encoder/Decoder</h2>

      <div class="tabs">
        <div class="tab active" data-tab="email-cleaner">Email Cleaner</div>
        <div class="tab" data-tab="encoder-decoder">Encoder/Decoder</div>
        <div class="tab" data-tab="extraction">Extraction Tool</div>
      </div>

      <div class="tab-content active" id="email-cleaner">
        <div class="main-layout">
          <div class="left-panel">
            <label for="input">Paste NEWSLITTER:</label>
            <textarea id="input" placeholder="Paste header here...">From: Restaurant Ordering System <help@newslitters.com>
Subject: Test Email
Date: Wed, 15 Nov 2023 10:30:00 +0000
To: recipient@example.com

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Test Email&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;This is a test email content.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</textarea>

            <input id="fileInput" type="file" accept=".txt,.eml,text/*" style="display:none"/>
            <div class="buttons">
              <button class="btn import-btn" id="importBtn">Import</button>
              <button class="btn clean-btn" id="cleanBtn">Clean</button>
              <button class="btn export-btn" id="exportBtn">Export</button>
              <button class="btn clear-btn" id="clearBtn">Clear</button>
              <button class="btn deselect-btn" id="deselectBtn">Deselect All</button>
            </div>
            
            <div class="filename-input">
              <label for="exportFilename">Export filename:</label>
              <input type="text" id="exportFilename" placeholder="Enter filename..." value="cleaned_header.txt" />
            </div>

            <h3>Choose PARAMS to remove:</h3>
            <div class="always-box">
              <label><b>(separated by comma):</b></label>
              <div class="always-inner">
                <input type="text" id="alwaysSelect" />
                <button type="button" id="applySelectBtn">笨費ｸSelect</button>
                <button type="button" id="resetDefaultBtn"> Reset Default</button>
              </div>
            </div>
            <div id="headersBox" class="headers-box">
              <p style="color:#666">痩 Paste or Import a header to see available fields...</p>
            </div>

            <div class="options">
              <label>Custom From Name:</label>
              <input type="text" id="customName" placeholder="FROM NAME (leave empty to keep original)" value="" />
              <button class="btn custom-name-btn" id="applyCustomNameBtn">Apply From Name</button>
              <div id="fromNameStatus" class="action-status">Already applied</div>
              <div style="margin:6px 0 10px">
                <label><input type="checkbox" id="toggleRdns"/> Replace domain with [RDNS]</label>
                <div id="rdnsStatus" class="action-status">Already applied</div>
                
                <label><input type="checkbox" id="toggleRpath"/> Replace domain with [P_RPATH]</label>
                <div id="rpathStatus" class="action-status">Already applied</div>
                
                <label><input type="checkbox" id="toggleEid"/> Add [eid] in Message-ID</label>
                <div id="eidStatus" class="action-status">Already applied</div>
                
                <label><input type="checkbox" id="toggleIp"/> Toggle [ip] before DOCTYPE/HTML/IMG</label>
                <div id="ipStatus" class="action-status">Already applied</div>
                
                <label><input type="checkbox" id="toggleHead"/> Add &lt;head&gt;&lt;select&gt; above DOCTYPE</label>
                <div id="headStatus" class="action-status">Already applied</div>
              </div>
              <button class="btn apply-btn" id="applyBtn">Apply</button>
            </div>

            <div class="options">
              <label>Custom Subject:</label>
              <input type="text" id="customSubject" placeholder="Enter custom subject..." />
              <button class="btn subject-btn" id="subjectBtn">Apply Subject</button>
              <div id="subjectStatus" class="action-status">Already applied</div>
            </div>
          </div>

          <div class="right-panel">
            <div class="preview-section">
              <div class="viewer-bar">
                <div class="viewer-toggles">
                  <div class="toggle" role="tablist" aria-label="Viewer mode">
                    <button id="btnGmail" class="active" role="tab" aria-selected="true">陶 Gmail View</button>
                    <button id="btnSource" role="tab" aria-selected="false"></> Source View</button>
                  </div>
                  <span class="chip">Live</span>
                </div>
                <label class="live-check"><input type="checkbox" id="liveToggle" checked /> Update while typing</label>
              </div>

              <div class="preview-wrap">
                <div id="gmailPreview" style="display:block">
                  <div class="gmail-chrome">
                    <span class="chip">Inbox</span>
                    <span style="font-weight:600">Preview</span>
                    <span style="margin-left:auto; font-size:12px; color:#7a7a7a">(Mock Gmail UI)</span>
                  </div>
                  <div class="gmail-body">
                    <iframe id="gmailFrame" title="Gmail-like preview"></iframe>
                  </div>
                </div>
                <pre id="sourceView" class="code-view" style="display:none"><code id="codeBlock"></code></pre>
              </div>
            </div>

            <div class="output-section">
              <h3>Cleaned STR:</h3>
              <textarea id="output" placeholder="Result will appear here..."></textarea>
            </div>

            <div class="insert-section">
              <div class="options">
                <label>Insert HTML:</label>
                <textarea id="insertText" placeholder="Enter text to insert above &lt;head&gt;&lt;select&gt;..."></textarea><br/>
                <button class="btn insert-btn" id="insertBtn">Insert HTML</button>
                <div id="insertStatus" class="action-status">Already applied</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="encoder-decoder">
        <div class="flex-2col">
          <div class="col">
            <h3>Encode/Decode Text</h3>
            <label for="encodeInput">Input Text:</label>
            <textarea id="encodeInput" placeholder="Enter text to encode or decode..."></textarea>
            
            <div class="encoding-options">
              <label><input type="radio" name="encodingType" value="base64" checked> Base64</label>
              <label><input type="radio" name="encodingType" value="url"> URL Encoding</label>
              <label><input type="radio" name="encodingType" value="html"> HTML Entities</label>
              <label><input type="radio" name="encodingType" value="hex"> Hex</label>
              <label><input type="radio" name="encodingType" value="quoted-printable"> Quoted-Printable</label>
            </div>
            
            <div class="buttons">
              <button class="btn encode-btn" id="encodeBtn">Encode</button>
              <button class="btn decode-btn" id="decodeBtn">Decode</button>
              <button class="btn clear-btn" id="clearEncodeBtn">Clear</button>
            </div>
            
            <h3>Result:</h3>
            <textarea id="encodeOutput" placeholder="Result will appear here..."></textarea>
          </div>
          
          <div class="col">
            <h3>About Encoding Types</h3>
            <div class="headers-box">
              <p><strong>Base64 Encoding:</strong> Converts binary data into ASCII characters. Commonly used for email attachments and data URLs.</p>
              <p><strong>URL Encoding:</strong> Replaces unsafe ASCII characters with a "%" followed by two hexadecimal digits.</p>
              <p><strong>HTML Entities:</strong> Replaces reserved HTML characters with entity names or numbers to prevent parsing issues.</p>
              <p><strong>Hex Encoding:</strong> Represents data with hexadecimal values (0-9, A-F).</p>
              <p><strong>Quoted-Printable:</strong> Encodes 8-bit characters into 7-bit ASCII. Used for MIME email messages.</p>
            </div>
            
            <h3>Quick Actions</h3>
            <div class="buttons">
              <button class="btn import-btn" id="copyEncodeBtn">Copy Result</button>
              <button class="btn export-btn" id="swapEncodeBtn">Swap Input/Output</button>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="extraction">
        <div class="input-section">
            <h2>Input Text</h2>
            <textarea id="inputText" placeholder="Paste your text here...">Example text with IPs like 192.168.1.1 and 10.0.0.1, domains like google.com and example.org, and server names like s_cmh8_2982, sr_cmh8_2982, server01 and db-server.</textarea>
            
            <div class="extraction-options">
                <div class="option">
                    <input type="checkbox" id="extractIPs" checked>
                    <label for="extractIPs">Extract IP Addresses</label>
                </div>
                <div class="option">
                    <input type="checkbox" id="extractServers" checked>
                    <label for="extractServers">Extract Server Names</label>
                </div>
                <div class="option">
                    <input type="checkbox" id="extractDomains" checked>
                    <label for="extractDomains">Extract Domains</label>
                </div>
            </div>
            
            <div class="server-pattern-info">
                <strong>Server Pattern Detection:</strong> The tool now recognizes server names like s_cmh8_2982 and sr_cmh8_2982
            </div>
            
            <div class="auto-extract-info">
                <strong>Auto-Extract Enabled:</strong> Results update automatically as you type or change options.
            </div>
            
            <div class="buttons">
                <button class="copy-btn" id="copyExtractionBtn">Copy Results</button>
                <button class="clear-btn extraction-clear" id="clearExtractionBtn">Clear Text</button>
            </div>
        </div>
        
        <div class="output-section">
            <h2>Extracted Results</h2>
            <div class="output-box" id="extractionOutputText"></div>
            <p class="results-info" id="resultsInfo">No results yet. Start typing or paste text to see extracted items.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Global and Common refs from both files
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const darkModeToggle = document.getElementById('darkModeToggle');

    // Email Cleaner refs
    const fileInput  = document.getElementById('fileInput');
    const importBtn  = document.getElementById('importBtn');
    const cleanBtn   = document.getElementById('cleanBtn');
    const exportBtn  = document.getElementById('exportBtn');
    const clearBtn   = document.getElementById('clearBtn');
    const deselectBtn= document.getElementById('deselectBtn');
    const applyBtn   = document.getElementById('applyBtn');
    const insertBtn  = document.getElementById('insertBtn');
    const inputArea  = document.getElementById('input');
    const outputArea = document.getElementById('output');
    const headersBox = document.getElementById('headersBox');
    const customNameInput = document.getElementById('customName');
    const insertTextInput = document.getElementById('insertText');
    const exportFilenameInput = document.getElementById('exportFilename');
    const historyToggle = document.getElementById('historyToggle');
    const historyPanel = document.getElementById('historyPanel');
    const historyItems = document.getElementById('historyItems');
    const clearHistoryBtn = document.getElementById('clearHistory');
    const closeHistoryBtn = document.getElementById('closeHistory');
    const historyCategories = document.getElementById('historyCategories');
    const customSubjectInput = document.getElementById('customSubject');
    const subjectBtn = document.getElementById('subjectBtn');
    const alwaysSelectInput = document.getElementById("alwaysSelect");
    const applySelectBtn = document.getElementById("applySelectBtn");
    const resetDefaultBtn = document.getElementById("resetDefaultBtn");
    const defaultHeaders = "ARC-Authentication-Results, ARC-Message-Signature, ARC-Seal, Authentication-Results, DKIM-Signature, Received-SPF, Return-Path, X-Google-Smtp-Source, sender, Delivered-To";
    const btnGmail = document.getElementById('btnGmail');
    const btnSource = document.getElementById('btnSource');
    const gmailPreview = document.getElementById('gmailPreview');
    const sourceView = document.getElementById('sourceView');
    const codeBlock = document.getElementById('codeBlock');
    const gmailFrame = document.getElementById('gmailFrame');
    const liveToggle = document.getElementById('liveToggle');
    const rdnsStatus = document.getElementById('rdnsStatus');
    const rpathStatus = document.getElementById('rpathStatus');
    const eidStatus = document.getElementById('eidStatus');
    const ipStatus = document.getElementById('ipStatus');
    const headStatus = document.getElementById('headStatus');
    const subjectStatus = document.getElementById('subjectStatus');
    const insertStatus = document.getElementById('insertStatus');
    const applyCustomNameBtn = document.getElementById('applyCustomNameBtn');
    const fromNameStatus = document.getElementById('fromNameStatus');
    
    // Encoder/Decoder refs
    const encodeInput = document.getElementById('encodeInput');
    const encodeOutput = document.getElementById('encodeOutput');
    const encodeBtn = document.getElementById('encodeBtn');
    const decodeBtn = document.getElementById('decodeBtn');
    const clearEncodeBtn = document.getElementById('clearEncodeBtn');
    const copyEncodeBtn = document.getElementById('copyEncodeBtn');
    const swapEncodeBtn = document.getElementById('swapEncodeBtn');
    const encodingTypeRadios = document.querySelectorAll('input[name="encodingType"]');

    // Extraction Tool refs
    const inputText = document.getElementById('inputText');
    const extractionOutputText = document.getElementById('extractionOutputText');
    const resultsInfo = document.getElementById('resultsInfo');
    const copyExtractionBtn = document.getElementById('copyExtractionBtn');
    const clearExtractionBtn = document.getElementById('clearExtractionBtn');
    const extractIPs = document.getElementById('extractIPs');
    const extractServers = document.getElementById('extractServers');
    const extractDomains = document.getElementById('extractDomains');

    // Track which actions have been applied
    let actionsApplied = {
      rdns: false, rpath: false, eid: false, ip: false, head: false,
      subject: false, insert: false, fromName: false
    };

    // Track original content to detect changes
    let originalContent = '';
    let history = JSON.parse(localStorage.getItem('emailCleanerHistory')) || [];
    let currentCategory = 'all';

    // ====== Tab functionality ======
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        
        // Deactivate all tabs and contents
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        // Activate the clicked tab and content
        tab.classList.add('active');
        document.getElementById(tabId).classList.add('active');
      });
    });

    // History functionality
    function addToHistory(type, content, filename = null, subject = null, fromName = null) {
      const timestamp = new Date().toLocaleString();
      const historyItem = {
        id: Date.now(), type, content, filename, subject, fromName, timestamp
      };
      
      history.unshift(historyItem);
      
      // Keep only the last 50 items
      if (history.length > 50) {
        history = history.slice(0, 50);
      }
      
      localStorage.setItem('emailCleanerHistory', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      historyItems.innerHTML = '';
      const filteredHistory = currentCategory === 'all' 
        ? history 
        : history.filter(item => item.type === currentCategory);
      
      if (filteredHistory.length === 0) {
        historyItems.innerHTML = '<div class="no-history">No history found for this category</div>';
        return;
      }
      
      filteredHistory.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'history-item';
        itemEl.setAttribute('data-type', item.type);
        
        let title = '';
        let contentPreview = truncateContent(item.content);
        
        switch(item.type) {
          case 'cleaned':
            title = 'Cleaned Content';
            break;
          case 'htmlInsert':
            title = 'HTML Inserted';
            break;
          case 'export':
            title = 'Exported File';
            contentPreview = `Filename: ${item.filename}`;
            break;
          case 'subject':
            title = 'Subject Changed';
            contentPreview = `New subject: ${item.subject}`;
            break;
          case 'fromName':
            title = 'From Name Changed';
            contentPreview = `New name: ${item.fromName}`;
            break;
          default:
            title = 'Activity';
        }
        
        itemEl.innerHTML = `<div class="history-title">${title}</div><div class="history-content">${contentPreview}</div><div class="history-timestamp">${item.timestamp}</div>`;
        itemEl.addEventListener('click', () => {
          if (item.type === 'cleaned') {
            outputArea.value = item.content;
            maybeUpdatePreview();
          } else if (item.type === 'htmlInsert') {
            insertTextInput.value = item.content;
          } else if (item.type === 'export') {
            exportFilenameInput.value = item.filename;
          } else if (item.type === 'subject') {
            customSubjectInput.value = item.subject;
          } else if (item.type === 'fromName') {
            customNameInput.value = item.fromName;
          }
          historyPanel.classList.remove('active');
        });
        historyItems.appendChild(itemEl);
      });
    }

    function truncateContent(content) {
      const maxLength = 100;
      return content.length > maxLength ? content.substring(0, maxLength) + '...' : content;
    }

    function clearHistory() {
      if (confirm('Are you sure you want to clear all history?')) {
        history = [];
        localStorage.removeItem('emailCleanerHistory');
        renderHistory();
      }
    }

    function setCategory(category) {
      currentCategory = category;
      document.querySelectorAll('.history-category').forEach(el => {
        el.classList.remove('active');
      });
      document.querySelector(`.history-category[data-category="${category}"]`).classList.add('active');
      renderHistory();
    }

    historyToggle.addEventListener('click', () => historyPanel.classList.add('active'));
    closeHistoryBtn.addEventListener('click', () => historyPanel.classList.remove('active'));
    clearHistoryBtn.addEventListener('click', clearHistory);
    document.querySelectorAll('.history-category').forEach(category => {
      category.addEventListener('click', () => setCategory(category.getAttribute('data-category')));
    });

    document.addEventListener('click', (e) => {
      if (!historyPanel.contains(e.target) && e.target !== historyToggle) {
        historyPanel.classList.remove('active');
      }
    });

    // File import
    importBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', async (evt) => {
      const file = evt.target.files[0];
      if (!file) return;
      inputArea.value = await file.text();
      fileInput.value = '';
      originalContent = inputArea.value;
      resetAllActions();
      buildHeaderCheckboxes();
      maybeUpdatePreview();
    });
    
    inputArea.addEventListener('input', () => { 
      if (inputArea.value !== originalContent) {
        resetAllActions();
        originalContent = inputArea.value;
      }
      buildHeaderCheckboxes(); 
      maybeUpdatePreview(); 
    });

    // Clear button resets all actions
    clearBtn.addEventListener('click', () => {
      inputArea.value = ""; 
      outputArea.value = "";
      originalContent = '';
      resetAllActions();
      headersBox.innerHTML = "<p style='color:#666'>痩 Paste or Import a header to see available fields...</p>";
      maybeUpdatePreview();
    });

    function resetAllActions() {
      actionsApplied = {
        rdns: false, rpath: false, eid: false, ip: false, head: false,
        subject: false, insert: false, fromName: false
      };
      const statusElements = document.querySelectorAll('.action-status');
      statusElements.forEach(el => el.style.display = 'none');
      document.getElementById('toggleRdns').checked = false;
      document.getElementById('toggleRpath').checked = false;
      document.getElementById('toggleEid').checked = false;
      document.getElementById('toggleIp').checked = false;
      document.getElementById('toggleHead').checked = false;
    }

    function buildHeaderCheckboxes() {
      const text = inputArea.value;
      if (!text.trim()) { headersBox.innerHTML = "<p style='color:#666'>痩 Paste or Import a header to see available fields...</p>"; return; }
      const matches = [...text.matchAll(/^([\w\-]+):/gmi)].map(m => m[1]);
      const unique = [...new Set(matches)].sort();
      if (!unique.length) { headersBox.innerHTML = "<p style='color:#666'>No headers found.</p>"; return; }
      headersBox.innerHTML = "";
      unique.forEach(h => {
        const id = "chk_" + h.replace(/[^a-z0-9]/gi, "_");
        const label = document.createElement("label");
        label.innerHTML = `<input type="checkbox" id="${id}" data-header="${h}" checked> ${h}`;
        headersBox.appendChild(label);
      });
      applyAlwaysSelect();
    }

    function removeHeaderBlock(text, header) {
      const re = new RegExp("(^" + header.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ".*(?:\\r?\\n[ \\t].*)*)", "gmi");
      return text.replace(re, "");
    }

    function cleanHeader() {
      let text = inputArea.value;
      if (!text.trim()) { alert("Paste or import a header first."); return; }
      const checks = headersBox.querySelectorAll("input[type=checkbox]:checked");
      checks.forEach(chk => { const h = chk.dataset.header; text = removeHeaderBlock(text,h); });
      text = text.replace(/^Received: by[^\n]*(?:\r?\n.*)?/gmi, "");
      text = text.replace(/^X-Received: by[^\n]*(?:\r?\n.*)?/gmi, "");
      text = text.replace(/^\s*[\r\n]/gm, "");
      outputArea.value = text.trim();
      addToHistory('cleaned', text.trim());
      resetAllActions();
    }
    cleanBtn.addEventListener('click', () => { cleanHeader(); maybeUpdatePreview(); });

    exportBtn.addEventListener('click', () => {
      const text = outputArea.value;
      if (!text.trim()) { alert("Nothing to export."); return; }
      let filename = exportFilenameInput.value.trim();
      if (!filename) filename = "cleaned_header.txt";
      if (!filename.endsWith('.txt')) {
        filename += '.txt';
      }
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
      addToHistory('export', text, filename);
    });

    deselectBtn.addEventListener('click', () => {
      const checks = headersBox.querySelectorAll("input[type=checkbox]");
      checks.forEach(chk => chk.checked = false);
    });

    function applyTransformations() {
      let text = outputArea.value || inputArea.value;
      if (!text.trim()) { alert("Paste, import, or clean a header first."); return; }
      let changed = false;

      if (document.getElementById("toggleRdns").checked && !actionsApplied.rdns) {
        text = text.replace(/^From:\s*(.*?)\s*<([^@>]+)@([^>]+)>/gmi, (match, displayName, username, domain) => {
          return `From: ${displayName.trim()} <${username}@[RDNS]>`;
        });
        actionsApplied.rdns = true; rdnsStatus.style.display = 'block'; changed = true;
      }
      if (document.getElementById("toggleRpath").checked && !actionsApplied.rpath) {
        text = text.replace(/^From:\s*(.*?)\s*<([^@>]+)@([^>]+)>/gmi, (match, displayName, username, domain) => {
          return `From: ${displayName.trim()} <${username}@[P_RPATH]>`;
        });
        actionsApplied.rpath = true; rpathStatus.style.display = 'block'; changed = true;
      }
      if (document.getElementById("toggleEid").checked && !actionsApplied.eid) {
        text = text.replace(/^Message-ID:\s*<([^@>]+)@([^>]+)>/gmi, "Message-ID: <$1[eid]@$2>");
        actionsApplied.eid = true; eidStatus.style.display = 'block'; changed = true;
      }
      if (document.getElementById("toggleIp").checked && !actionsApplied.ip) {
        if (!text.includes("[ip]")) {
          text = text.replace(/(<!DOCTYPE|<html|<img|<body|<head)/i, "\n[ip]\n$1");
          actionsApplied.ip = true; ipStatus.style.display = 'block'; changed = true;
        }
      }
      if (document.getElementById("toggleHead").checked && !actionsApplied.head) {
        if (!text.includes("<head><select>")) {
          const headSelectPattern = /(<!DOCTYPE|<html|<body|<head)/i;
          text = text.replace(headSelectPattern, "<head><select>\n$1");
          actionsApplied.head = true; headStatus.style.display = 'block'; changed = true;
        }
      }
      if (changed) {
        outputArea.value = text.trim();
        maybeUpdatePreview();
      } else {
        alert("No new transformations applied. These actions may have already been applied to this content.");
      }
    }
    applyBtn.addEventListener('click', applyTransformations);

    function applyCustomName() {
      let text = outputArea.value || inputArea.value;
      if (!text.trim()) { alert("Paste, import, or clean a header first."); return; }
      const customName = customNameInput.value.trim();
      if (!customName) { alert("Please enter a custom From name."); return; }
      if (actionsApplied.fromName) { alert("Custom From Name has already been applied to this content."); return; }
      
      const fromRegex = /^From:\s*("([^"]+)"|'([^']+)'|[^<]+)?\s*<([^>]+)>/gmi;
      if (fromRegex.test(text)) {
        text = text.replace(fromRegex, (match, p1, p2, p3, email) => {
          return `From: "${customName}" <${email}>`;
        });
      } else {
        alert("No 'From' header found to modify.");
        return;
      }
      
      outputArea.value = text.trim();
      actionsApplied.fromName = true;
      fromNameStatus.style.display = 'block';
      addToHistory('fromName', text, null, null, customName);
      maybeUpdatePreview();
    }
    applyCustomNameBtn.addEventListener('click', applyCustomName);

    function applyCustomSubject() {
      let text = outputArea.value || inputArea.value;
      if (!text.trim()) { alert("Paste, import, or clean a header first."); return; }
      const customSubject = customSubjectInput.value.trim();
      if (!customSubject) { alert("Please enter a custom subject."); return; }
      if (actionsApplied.subject) { alert("Subject has already been applied to this content."); return; }
      if (text.includes("Subject:")) {
        text = text.replace(/^Subject:.*$/gmi, `Subject: ${customSubject}`);
      } else {
        text = `Subject: ${customSubject}\n${text}`;
      }
      outputArea.value = text;
      actionsApplied.subject = true;
      subjectStatus.style.display = 'block';
      addToHistory('subject', text, null, customSubject);
      maybeUpdatePreview();
    }
    subjectBtn.addEventListener('click', applyCustomSubject);

    function insertCustomHtml() {
      let text = outputArea.value || inputArea.value;
      if (!text.trim()) { alert("Paste, import, or clean a header first."); return; }
      const customText = insertTextInput.value;
      if (!customText.trim()) { alert("Write something first."); return; }
      if (actionsApplied.insert) { alert("HTML has already been inserted into this content."); return; }
      const headSelectPattern = /(<head>\s*<select>)/i;
      if (headSelectPattern.test(text)) {
        text = text.replace(headSelectPattern, "\n" + customText + "\n$1");
        outputArea.value = text;
        actionsApplied.insert = true;
        insertStatus.style.display = 'block';
        maybeUpdatePreview();
        addToHistory('htmlInsert', customText);
      } else {
        alert("No <head><select> tag found in the content. Please apply the 'Add <head><select>' option first.");
      }
    }
    insertBtn.addEventListener('click', insertCustomHtml);

    // Always select functions
    function applyAlwaysSelect() {
      const input = alwaysSelectInput.value;
      if (!input.trim()) return;
      const mustSelect = input.split(",").map(s => s.trim().toLowerCase()).filter(Boolean);
      const checks = document.querySelectorAll("#headersBox input[type=checkbox]");
      checks.forEach(chk => { if (mustSelect.includes(chk.dataset.header.toLowerCase())) { chk.checked = true; } });
    }
    alwaysSelectInput.addEventListener("input", () => { localStorage.setItem("alwaysSelectParams", alwaysSelectInput.value); });
    window.addEventListener("load", () => {
      const saved = localStorage.getItem("alwaysSelectParams");
      alwaysSelectInput.value = saved || defaultHeaders;
      renderHistory();
      maybeUpdatePreview();
      const darkMode = localStorage.getItem("darkMode") === "true";
      if (darkMode) {
        document.body.classList.add("dark-mode");
        darkModeToggle.classList.add("active");
      }
      const savedFilename = localStorage.getItem("exportFilename");
      if (savedFilename) {
        exportFilenameInput.value = savedFilename;
      }
      
      // Initial extraction in the new tab
      performExtraction();
    });
    applySelectBtn.addEventListener("click", () => { applyAlwaysSelect(); });
    resetDefaultBtn.addEventListener("click", () => {
      alwaysSelectInput.value = defaultHeaders; applyAlwaysSelect(); localStorage.setItem("alwaysSelectParams", defaultHeaders);
    });
    
    exportFilenameInput.addEventListener("input", () => {
      localStorage.setItem("exportFilename", exportFilenameInput.value);
    });

    // ====== Live preview logic ======
    function getWorkingText(){
      const out = outputArea.value.trim();
      const inp = inputArea.value.trim();
      return out || inp || '';
    }
    function extractHtmlDocument(raw){
      if(!raw) return '';
      const idxDoc = raw.search(/<!DOCTYPE[\s\S]*?<html[\s\S]*?>/i);
      const idxHtml = raw.search(/<html[\s\S]*?>/i);
      const start = idxDoc >= 0 ? idxDoc : (idxHtml >= 0 ? idxHtml : -1);
      if(start >= 0){ return raw.slice(start); }
      const escaped = raw.replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));
      return `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Preview</title></head><body><pre style="white-space:pre-wrap">${escaped}</pre></body></html>`;
    }
    function setIframeHtml(html){
      const doc = gmailFrame.contentDocument || gmailFrame.contentWindow.document;
      doc.open(); doc.write(html); doc.close();
    }
    function setCodeView(html){
      const safe = html.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      const lines = safe.split(/\r?\n/).map(l => `<span>${l}</span>`).join('');
      codeBlock.innerHTML = lines;
    }
    function updatePreview(){
      const raw = getWorkingText();
      const html = extractHtmlDocument(raw);
      setIframeHtml(html);
      setCodeView(html);
    }
    function maybeUpdatePreview(){ if(liveToggle.checked) updatePreview(); }

    outputArea.addEventListener('input', maybeUpdatePreview);
    liveToggle.addEventListener('change', () => { if(liveToggle.checked) updatePreview(); });

    // Toggle buttons
    function setActive(btn){
      [btnGmail, btnSource].forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    btnGmail.addEventListener('click', () => {
      setActive(btnGmail);
      gmailPreview.style.display='block';
      sourceView.style.display='none';
    });
    btnSource.addEventListener('click', () => {
      setActive(btnSource);
      gmailPreview.style.display='none';
      sourceView.style.display='block';
    });

    // Dark mode functionality
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      darkModeToggle.classList.toggle('active');
      const isDarkMode = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDarkMode);
    });

    // Quoted-Printable functions
    function quotedPrintableEncode(str) {
      let result = '';
      for (let i = 0; i < str.length; i++) {
        const charCode = str.charCodeAt(i);
        if ((charCode >= 33 && charCode <= 126 && charCode !== 61) || charCode === 9 || charCode === 32) {
          result += str[i];
        } else {
          result += `=${charCode.toString(16).toUpperCase()}`;
        }
      }
      return result;
    }
    
    function quotedPrintableDecode(str) {
      return str.replace(/=([A-Fa-f0-9]{2})/g, (match, hex) => {
        return String.fromCharCode(parseInt(hex, 16));
      }).replace(/=\r?\n/g, ''); // Handle soft line breaks
    }
    
    // ====== Encoding/Decoding functionality ======
    function getSelectedEncodingType() {
      for (const radio of encodingTypeRadios) {
        if (radio.checked) return radio.value;
      }
      return 'base64'; // default
    }

    function encodeText() {
      const text = encodeInput.value.trim();
      if (!text) { alert("Please enter some text to encode."); return; }
      const encodingType = getSelectedEncodingType();
      let result;
      
      try {
        switch(encodingType) {
          case 'base64':
            result = btoa(unescape(encodeURIComponent(text)));
            break;
          case 'url':
            result = encodeURIComponent(text);
            break;
          case 'html':
            result = text.replace(/[&<>"']/g, m => ({
              '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            }[m]));
            break;
          case 'hex':
            result = Array.from(text).map(c => 
              c.charCodeAt(0).toString(16).padStart(2, '0')
            ).join(' ');
            break;
          case 'quoted-printable':
            result = quotedPrintableEncode(text);
            break;
          default:
            result = "Unsupported encoding type";
        }
        encodeOutput.value = result;
      } catch (e) {
        encodeOutput.value = "Error: " + e.message;
      }
    }

    function decodeText() {
      const text = encodeInput.value.trim();
      if (!text) { alert("Please enter some text to decode."); return; }
      const encodingType = getSelectedEncodingType();
      let result;
      
      try {
        switch(encodingType) {
          case 'base64':
            result = decodeURIComponent(escape(atob(text)));
            break;
          case 'url':
            result = decodeURIComponent(text);
            break;
          case 'html':
            result = text.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '"').replace(/&#39;/g, "'");
            break;
          case 'hex':
            const cleanHex = text.replace(/\s/g, '');
            let hexResult = '';
            for (let i = 0; i < cleanHex.length; i += 2) {
                const pair = cleanHex.substring(i, i + 2);
                if (pair.length === 2) {
                    hexResult += String.fromCharCode(parseInt(pair, 16));
                }
            }
            result = hexResult;
            break;
          case 'quoted-printable':
            result = quotedPrintableDecode(text);
            break;
          default:
            result = "Unsupported encoding type";
        }
        encodeOutput.value = result;
      } catch (e) {
        encodeOutput.value = "Error: " + e.message;
      }
    }

    function copyEncodeResult() {
      if (!encodeOutput.value.trim()) { alert("No result to copy."); return; }
      encodeOutput.select();
      document.execCommand('copy');
      alert("Copied to clipboard!");
    }

    function swapEncodeText() {
      const temp = encodeInput.value;
      encodeInput.value = encodeOutput.value;
      encodeOutput.value = temp;
    }

    encodeBtn.addEventListener('click', encodeText);
    decodeBtn.addEventListener('click', decodeText);
    clearEncodeBtn.addEventListener('click', () => { encodeInput.value = ''; encodeOutput.value = ''; });
    copyEncodeBtn.addEventListener('click', copyEncodeResult);
    swapEncodeBtn.addEventListener('click', swapEncodeText);

    // ====== Extraction Tool functionality ======
    function extractFromText(text, options) {
        const results = { ips: [], servers: [], domains: [] };
        if (options.ips) {
            const ipRegex = /\b(?:\d{1,3}\.){3}\d{1,3}\b/g;
            results.ips = text.match(ipRegex) || [];
        }
        if (options.servers) {
            const customServerRegex = /\b(?:s|sr)_[a-zA-Z]+\d+_\d+\b/g;
            const commonServerRegex = /\b[a-zA-Z0-9][a-zA-Z0-9\-_]*(?=\s*(?:server|host|machine|node))\b/gi;
            const serverPatternRegex = /\b(?:server|srv|host|node)[-_]?[a-zA-Z0-9]+\b/gi;
            const customMatches = text.match(customServerRegex) || [];
            const commonMatches = text.match(commonServerRegex) || [];
            const patternMatches = text.match(serverPatternRegex) || [];
            results.servers = [...new Set([...customMatches, ...commonMatches, ...patternMatches])];
        }
        if (options.domains) {
            const domainRegex = /\b(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}\b/g;
            results.domains = text.match(domainRegex) || [];
        }
        return results;
    }
    
    function displayExtractionResults(results) {
        let output = '';
        let totalItems = 0;
        if (results.ips.length > 0) {
            output += 'IP Addresses:\n' + [...new Set(results.ips)].join('\n') + '\n\n';
            totalItems += [...new Set(results.ips)].length;
        }
        if (results.servers.length > 0) {
            output += 'Server Names:\n' + [...new Set(results.servers)].join('\n') + '\n\n';
            totalItems += [...new Set(results.servers)].length;
        }
        if (results.domains.length > 0) {
            output += 'Domains:\n' + [...new Set(results.domains)].join('\n') + '\n\n';
            totalItems += [...new Set(results.domains)].length;
        }
        if (output === '') {
            extractionOutputText.textContent = 'No items found matching your criteria.';
            resultsInfo.textContent = 'No items extracted.';
        } else {
            extractionOutputText.textContent = output.trim();
            resultsInfo.textContent = `Extracted ${totalItems} unique item(s).`;
        }
    }
    
    function performExtraction() {
        const text = inputText.value;
        const options = {
            ips: extractIPs.checked,
            servers: extractServers.checked,
            domains: extractDomains.checked
        };
        const results = extractFromText(text, options);
        displayExtractionResults(results);
    }
    
    inputText.addEventListener('input', performExtraction);
    extractIPs.addEventListener('change', performExtraction);
    extractServers.addEventListener('change', performExtraction);
    extractDomains.addEventListener('change', performExtraction);
    
    copyExtractionBtn.addEventListener('click', function() {
        const textToCopy = extractionOutputText.textContent;
        if (textToCopy && textToCopy !== 'No items found matching your criteria.') {
            navigator.clipboard.writeText(textToCopy).then(function() {
                const originalText = copyExtractionBtn.textContent;
                copyExtractionBtn.textContent = 'Copied!';
                setTimeout(function() {
                    copyExtractionBtn.textContent = originalText;
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy text to clipboard. Please select and copy manually.');
            });
        }
    });
    
    clearExtractionBtn.addEventListener('click', function() {
        inputText.value = '';
        extractionOutputText.textContent = '';
        resultsInfo.textContent = 'Text cleared. No results to display.';
    });
  </script>
</body>
</html>
```
